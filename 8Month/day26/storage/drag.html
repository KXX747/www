<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #box{width:100px;height: 100px;background: red;position: absolute;left:0;top:0;}
    </style>
</head>
<body>
    <div id="box"></div>
</body>
<script>
    // 拖拽
    // 每次拖拽结束，保存位置，关闭浏览器，下次打开，还在上次的位置
    // 多个页面，多个拖拽，又拽一个，其他跟随移动

    class Drag{
        constructor(){
            this.ele = document.getElementById("box");
            // 因为将来准备使用事件监听式绑定事件，所以为了方便this的使用和将来删除事件，所以提前使用bind将函数处理
            this.m = this.move.bind(this);
            this.u = this.up.bind(this);

            this.init();
            this.addEvent();
        }
        init(){
            var pos = JSON.parse(localStorage.getItem("pos"));
            if(pos!=null){
                this.ele.style.left = pos.x + "px";
                this.ele.style.top = pos.y + "px";
            }
           
        }
        addEvent(){
            this.ele.addEventListener("mousedown",this.down.bind(this))
        }
        down(eve){
            var e = eve || window.event;
            this.x = e.offsetX;
            this.y = e.offsetY;

            // 绑定提前处理好的事件处理函数，this好用，删除时也能找到同一个
            document.addEventListener("mousemove",this.m);
            document.addEventListener("mouseup",this.u);
        }
        move(eve){
            var e = eve || window.event;
            this.ele.style.left = e.clientX - this.x + "px";
            this.ele.style.top = e.clientY - this.y + "px";

            // 存坐标
            var pos = {
                x:this.ele.offsetLeft,
                y:this.ele.offsetTop
            }
            localStorage.setItem("pos",JSON.stringify(pos));
        }
        up(){
            // 删除时找的是，初始改变了this之后的新函数，与绑定的是同一个新函数
            document.removeEventListener("mousemove",this.m);
            document.removeEventListener("mouseup",this.u);
        }
    }

new Drag();
</script>
</html>