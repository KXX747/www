<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<style>
    *{
        margin: 0 ; 
        padding: 0;
        list-style-type: none;
    }
    .pagWarp{
        height: 40px;
        box-shadow: 0 2px 5px #b6b6b6;
        position: absolute;
        border-radius: 2px;
        right: 42%;
        top: 430px;
    }
    #btnL,#btnR{
        line-height: 40px;
        cursor: pointer;
    }
    #btnL{
        float: left;
    }
    #btnR{
        float: right;             
    }
    .pagWarp ul{        
        height: 40px;
        margin: 0 auto;
        float: left;
        text-align: center;
        padding-left: 40px;
        padding-right: 40px;
    }
    .pagWarp ul li{
        float: left;
        text-align: center;
        line-height: 40px;
        padding: 0 4px;
    }
    .active{
        color: blue;
        font-size: 30px;
    }

    /* 商品列表样式 */
.list{
    width: 80%;
    margin: 20px auto;
}
.list:after{
    content:'';
    display: block;
    clear: both;
}
.list li{
    padding:2%;
    width: 15%;
    float: left;
    height: 300px;
    color: #666;
    border-right: 1px solid #b6b6b6;
      box-shadow: 2px 2px 5px #b6b6b6;  
      margin-left: 8px;
      margin-top: 20px;
}
.list li h2{
    font-size: 18px;
    text-align: center;
    line-height: 30px;
}
.list .img{
    width: 100%;
    border: 1px solid #b6b6b6;
    height: 180px;
}
.list input[type=button]{
    display: block;
    margin: 0 auto;
    border: 1px solid #b6b6b6;
    width: 100px;
    height: 80px;
}
</style>
<body>
    <ul class="list" id="list">
    </ul>
    <div class="pagWarp" id="pageWarp">
        <span id="btnL">上一页</span>
        <ul id="page">
        </ul>
        <span id="btnR">下一页</span>
    </div>
</body>
<script src="../ajax.js"></script>
<script>
//	console.log(ajaxGet);

//	OOA:ajax请求数据，分页
//		1.请求数据
//			ajax
//				1.2.3.4
//		2.渲染页面
//			有数据,遍历数据(json,数组),拼接字符串,innerHTML插入
//		3.渲染页码
//			数据长度 / 单页显示的数量，向上取整，根据这个数字，动态创建li，表示页码
//		4.绑定事件
//			???
//		5.计算页码索引
//			???
//		6.根据页码的索引,重新渲染页面
//			...
		
//	OOD:
//		class Page{
//			constructor(){
////				属性
////				索引
////				1.请求数据
//				this.laod();
////				4.绑定事件
//				this.addEvent();
//			}
//			load(){
//					
////					2.渲染页面
// 					this.display()
////					3.渲染页码
//					this.createPage()
//			}
//			display(){
////				渲染页面
//			}
//			createPage(){
////				渲染页码
//			}
//			addEvent(){
////				绑定事件
////					5.计算索引
//					this.changeIndex()
//			}
//			changeIndex(){
//				
////				6.渲染页面
//				this.display();
//			}
//		}
	
//	OOP:
		class Page{
			constructor(options){
//				属性
				this.list = options.list;
				this.left = options.left;
				this.right = options.right;
				this.pageCont = options.pageCont;
				this.num = options.num;
				this.index = options.index;
				this.url = options.url;
				
//				1.请求数据
				this.load();
//				4.绑定事件
				this.addEvent();
			}
			load(){
				ajaxGet(this.url,(res)=>{
//					console.log(res);
					this.res = JSON.parse(res);
//					this.res = eval(res);
//					2.渲染页面
					this.display()
//					3.渲染页码
					this.createPage()
				})
			}
			display(){
//				console.log(this.res)
//				渲染页面
				var str = "";
				
//				0~5			this.index0*this.num5	~	(this.index0+1)*this.num5
//				5~10		this.index1*this.num5	~	(this.index1+1)*this.num5
//				10~15		this.index2*this.num5	~	(this.index2+1)*this.num5

//				this.index*this.num~(this.index+1)*this.num

				for(var i=this.index*this.num;i<(this.index+1)*this.num;i++){
					if(i<this.res.length){
						str += `<li>
	                            <img src="${this.res[i].url}" class="img">        
	                            <h2>商品名称:<span>${this.res[i].name}</span></h2>
	                            <h2>商品介绍:<span>${this.res[i].tip}</span></h2>
	                            <h2>商品价格:<span>${this.res[i].price}</span></h2>
	                        </li>`;
					}
				}
				this.list.innerHTML = str;
			}
			createPage(){
//				console.log(this.res)
//				渲染页码
				this.maxNum = Math.ceil(this.res.length / this.num);
				var str = "";
				for(var i=0;i<this.maxNum;i++){
					str += `<li>${i+1}</li>`
				}
				this.pageCont.innerHTML = str;
				
				this.setActive();
			}
//			辅助操作,设置页码的当前项
			setActive(){
				for(var i=0;i<this.pageCont.children.length;i++){
					this.pageCont.children[i].className = "";
				}
				this.pageCont.children[this.index].className = "active";
			}
			addEvent(){
				var that = this;
//				绑定事件
				this.left.onclick = function(){
//					5.计算索引
					that.changeIndex(0)
				}
				this.right.onclick = function(){
//					5.计算索引
					that.changeIndex(1)
				}
			}
			changeIndex(type){
				if(type == 0){
					if(this.index == 0){
						this.index = this.maxNum-1;
					}else{
						this.index--;
					}
				}else{
					if(this.index == this.maxNum-1){
						this.index = 0
					}else{
						this.index++
					}
				}
				
				this.setActive();
//				console.log(this.index)
//				6.渲染页面
				this.display();
			}
		}
	
	
//	工具的思想:分页工具:可以适应各种结构,各种布局,各种数据
//	要求:必须将数据的接口,默认显示的数据条数,默认的页码,默认数据放在哪个容器,默认左右按钮,默认页码的容器,全部传参
//	传什么样的参数,就控制什么样的内容
	
	new Page({
		list:document.getElementById("list"),
		left:document.getElementById("btnL"),
		right:document.getElementById("btnR"),
		pageCont:document.getElementById("page"),
		url:"http://localhost/1906/page/goods.json",
		num:2,
		index:1
	});
	
</script>
</html>